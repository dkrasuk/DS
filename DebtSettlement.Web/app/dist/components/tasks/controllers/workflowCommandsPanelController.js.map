{"version":3,"sources":["../../../../src/components/tasks/controllers/workflowCommandsPanelController.js"],"names":["app","components","tasks","controllers","WorkflowCommandsPanelController","template","commands","$","utils","tasksService","global","dataBinder","events","$elem","init","html","i","length","button","createCommandButton","appendTo","callEvents","showDefaultError","form","ui","loader","error","text","command","LocalizedName","data","on","Parameters","displayCommandParametersDialog","confirm","func","submitCommand","id","ParameterName","validateRules","c","commandParemeterControll","createCommandParemeterControll","title","content","width","height","validateCommandParameters","notify","fn","validate","rules","parameter","Settings","result","label","input","css","rule","Type","wrap","after","datePickerParams","dateFormat","lang","timepicker","dayOfWeekStart","minDate","Date","onSelect","dt","element","m","selectedMonth","d","selectedDay","date","selectedYear","Value","MinValue","MaxValue","maxDate","datepicker","mask","placeholder","pattern","f","M","F","y","getFullYear","getMonth","getDate","append","с","startsWith","reverse","DataSource","source","settings","ajax","url","urlContent","split","trim","cache","dataType","delay","params","term","$skip","page","$top","$orderby","processResults","results","pagination","more","endsWith","JSON","parse","toLower","replace","select2","Pattern","MinLength","minlength","MaxLength","maxlength","MimValue","min","max","val","DefaultValue","IsRequired","addClass","attr","$this","removeClass","valid","parameters","map","item","executeCommand","ProcessId","CommandName","then","name","eventsArray","context","e","call","push"],"mappings":"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","file":"workflowCommandsPanelController.js","sourcesContent":["﻿; var app = app || {};\r\napp.components = app.components || {};\r\napp.components.tasks = app.components.tasks || {};\r\napp.components.tasks.controllers = app.components.tasks.controllers || {}\r\napp.components.tasks.controllers.WorkflowCommandsPanelController = app.components.tasks.controllers.WorkflowCommandsPanelController ||\r\n    function (template, commands, $, utils, tasksService, global, app, dataBinder) {\r\n        'use strict';\r\n        //available events: init, click, submit\r\n        var events = {};\r\n        var $elem = $(template);\r\n\r\n        function init() {\r\n            if (commands) {\r\n                $elem.html('');\r\n                for (var i = 0; i < commands.length; i++) {\r\n                    var button = createCommandButton(commands[i]);\r\n                    button.appendTo($elem);\r\n                }\r\n            }\r\n            callEvents('init', events);\r\n        }\r\n\r\n        function showDefaultError(form) {\r\n            utils.ui.loader(form, false);\r\n            utils.ui.error({\r\n                text: 'Что-то пошло не так. Случилась ошибка при отправке запроса'\r\n            });\r\n        }\r\n\r\n        function createCommandButton(command) {\r\n            var button = $('<button class=\"btn btn-md btn-primary\">' + command.LocalizedName + '</button>');\r\n            button.data('wf-command', command);\r\n            button.on('click', function () {\r\n                callEvents('click', events, command);\r\n                if (command.Parameters) {\r\n                    displayCommandParametersDialog(command);\r\n                } else {\r\n                    utils.ui.confirm({\r\n                        text: 'Вы уверены что выполнить действие \"' + command.LocalizedName + '\"',\r\n                        func: function () {\r\n                            submitCommand(command);\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n            return button;\r\n        }\r\n\r\n        function displayCommandParametersDialog(command) {\r\n            var id = 'commandParametersWindow' + command.ParameterName;\r\n            var html = $('<form id=\"' + id + '\"></form>');\r\n            var validateRules = {};\r\n            for (var c = 0; c < command.Parameters.length; c++) {\r\n                var commandParemeterControll = createCommandParemeterControll(command.Parameters[c], validateRules);\r\n                commandParemeterControll.appendTo(html);\r\n            }\r\n            utils.ui.confirm({\r\n                title: command.LocalizedName,\r\n                content: html,\r\n                width: 600,\r\n                height: 350,\r\n                func: function () {\r\n                    if (validateCommandParameters(html, command)) {\r\n                        submitCommand(command);\r\n                        return true;\r\n                    } else {\r\n                        utils.ui.notify('Ошибка!', 'Не все параметры заполнены корректно.', 'error');\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n            if ($.fn.validate) {\r\n                html.validate({\r\n                    rules: validateRules\r\n                });\r\n            }\r\n        }\r\n\r\n        function createCommandParemeterControll(parameter, validateRules) {\r\n            parameter.Settings = parameter.Settings || {};\r\n\r\n            var result = $('<div class=\"form-group\"></div>');\r\n            var label = $('<label>' + parameter.LocalizedName + '</label>').appendTo(result);\r\n            var input = $('<input  class=\"form-control\" name=\"' + parameter.ParameterName + '\"/>');\r\n            input.css('width', '100%');\r\n\r\n            var rule = validateRules[parameter.ParameterName] = {};\r\n            if (parameter.Type === 'DateTime') {\r\n                input.wrap('<div class=\"input-group\" style=\"width:220px\"></div>');\r\n                input.after('<span class=\"input-group-addon\"><i class=\"glyphicon glyphicon-calendar\"></i></span>');\r\n                input.css('width', '200px');\r\n                var datePickerParams = {\r\n                    dateFormat: 'dd/mm/yy',\r\n                    lang: 'uk',\r\n                    timepicker: false,\r\n                    dayOfWeekStart: 1,\r\n                    minDate: new Date(),\r\n                    onSelect: function (dt, element) {\r\n                        var m = element.selectedMonth + 1;\r\n                        var d = element.selectedDay;\r\n                        var date = element.selectedYear\r\n                            + '-' + (m < 10 ? '0' + m : m)\r\n                            + '-' + (d < 10 ? '0' + d : d) + 'T00:00:00';\r\n                        parameter.Value = date;\r\n                    }\r\n                };\r\n                if (parameter.Settings.MinValue) {\r\n                    datePickerParams.minDate = new Date(parameter.Settings.MinValue);\r\n                }\r\n                if (parameter.Settings.MaxValue) {\r\n                    datePickerParams.maxDate = new Date(parameter.Settings.MaxValue);\r\n                }\r\n\r\n                input.datepicker(datePickerParams)\r\n                .mask('df/MF/yyyy', {\r\n                    placeholder: '__/__/____',\r\n                    'translation': {\r\n                        d: { pattern: /[0-3]/ },\r\n                        f: { pattern: /[0-9]/ },\r\n                        M: { pattern: /[0-1]/ },\r\n                        F: { pattern: /[0-9]/ },\r\n                        y: { pattern: /[0-9]/ }\r\n                    }\r\n                });\r\n\r\n                rule.dateFormat = true;\r\n                if (datePickerParams.minDate) {\r\n                    rule.minDate = new Date(\r\n                        datePickerParams.minDate.getFullYear(),\r\n                        datePickerParams.minDate.getMonth(),\r\n                        datePickerParams.minDate.getDate());\r\n                }\r\n                if (datePickerParams.maxDate) {\r\n                    rule.maxDate = new Date(\r\n                        datePickerParams.maxDate.getFullYear(),\r\n                        datePickerParams.maxDate.getMonth(),\r\n                        datePickerParams.maxDate.getDate());\r\n                }\r\n\r\n                result.append(input);\r\n            } else {\r\n                if (parameter.Type === 'Char') {\r\n                    input.mask('с', { 'translation': { с: { pattern: /\\S/ } } });\r\n                }\r\n                if (parameter.Type === 'Decimal' || parameter.Type.startsWith('Int')) {\r\n                    input.mask('#9', { reverse: true });\r\n                }\r\n\r\n                if (parameter.Settings) {\r\n                    if (parameter.Settings.DataSource) {\r\n                        input = $('<select  class=\"form-control\" name=\"' + parameter.ParameterName + '\"/>');\r\n                        input.css('width', '100%');\r\n                        result.append(input);\r\n                        var source = parameter.Settings.DataSource;\r\n                        var settings = {}\r\n\r\n                        if (source.startsWith('dictionary')) {\r\n                            settings.ajax = {\r\n                                url: utils.urlContent('/api/dictionary/' + source.split(':')[1].trim()),\r\n                                cache: true,\r\n                                dataType: 'json',\r\n                                delay: 250,\r\n                                data: function (params) {\r\n                                    return {\r\n                                        term: params.term, // search term\r\n                                        $skip: ((params.page || 1) * 100) - 100,\r\n                                        $top: 100,\r\n                                        $orderby: 'id'\r\n                                    };\r\n                                },\r\n                                processResults: function (data, params) {\r\n                                    params.page = params.page || 1;\r\n                                    return {\r\n                                        results: data,\r\n                                        pagination: {\r\n                                            more: (params.page * 100) < (data.length * params.page) + 1\r\n                                        }\r\n                                    };\r\n                                }\r\n                            };\r\n                        } else if (source.startsWith('[') && source.endsWith(']')) {\r\n                            settings.data = JSON.parse(source);\r\n                        } else if (source.toLower().startsWith('http://') || source.toLower().startsWith('https://')) {\r\n                            settings.ajax = {\r\n                                url: source\r\n                            };\r\n                        } else if (source.startsWith('~/')) {\r\n                            settings.ajax = {\r\n                                url: utils.urlContent(source.replace('~/', ''))\r\n                            };\r\n                        }\r\n\r\n                        input.select2(settings);\r\n                    } else {\r\n                        if (parameter.Settings.Pattern) {\r\n                            rule.pattern = parameter.Settings.Pattern;\r\n                        }\r\n\r\n                        if (parameter.Settings.MinLength) {\r\n                            rule.minlength = parameter.Settings.MinLength;\r\n                        }\r\n                        if (parameter.Settings.MaxLength) {\r\n                            rule.maxlength = parameter.Settings.MaxLength;\r\n                        }\r\n\r\n                        if (parameter.Settings.MimValue) {\r\n                            rule.min = parameter.Settings.MimValue;\r\n                        }\r\n                        if (parameter.Settings.MaxValue) {\r\n                            rule.max = parameter.Settings.MaxValue;\r\n                        }\r\n                    }\r\n                }\r\n                result.append(input);\r\n                input.val(parameter.DefaultValue);\r\n                parameter.Value = parameter.DefaultValue;\r\n            }\r\n\r\n            if (parameter.IsRequired) {\r\n                label.addClass('required');\r\n                input.addClass('required').attr('required', 'required');\r\n                input.on('change', function () {\r\n                    var $this = $(this);\r\n                    if (!$this.val()) {\r\n                        $this.addClass('error');\r\n                    } else {\r\n                        $this.removeClass('error');\r\n                    }\r\n                });\r\n            }\r\n            input.data('wf-command-parameter', parameter);\r\n            input.on('change', function () {\r\n                var $this = $(this);\r\n                parameter.Value = $this.val();\r\n            });\r\n\r\n            return result;\r\n        }\r\n\r\n        function validateCommandParameters(html) {\r\n            var result = true;\r\n            if (!html.valid()) {\r\n                result = false;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        function submitCommand(command) {\r\n            utils.ui.loader($elem);\r\n            var parameters = {};\r\n            command.Parameters.map(function (item) {\r\n                parameters[item.ParameterName] = item.Value;\r\n            });\r\n            tasksService.executeCommand(command.ProcessId, command.CommandName, parameters).then(\r\n                function () {\r\n                    utils.ui.loader($elem, false);\r\n                    utils.ui.notify('Успешно!', 'Данные сохранены <span class=\"glyphicon glyphicon-thumbs-up\"></span>', 'success');\r\n                    callEvents('submit', events, command);\r\n                },\r\n                function () {\r\n                    showDefaultError($elem);\r\n                });\r\n\r\n\r\n        }\r\n\r\n        function callEvents(name, eventsArray, context) {\r\n            if (eventsArray[name]) {\r\n                for (var e = 0; e < eventsArray[name].length; e++) {\r\n                    eventsArray[name][e].call(context);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.on = function (name, func) {\r\n            events[name] = events[name] || [];\r\n            events[name].push(func);\r\n        };\r\n        this.init = init;\r\n    }"]}