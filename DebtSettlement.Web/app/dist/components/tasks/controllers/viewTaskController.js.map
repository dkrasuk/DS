{"version":3,"sources":["../../../../src/components/tasks/controllers/viewTaskController.js"],"names":["app","components","tasks","controllers","ViewTaskController","global","$","utils","dataBinder","tasksService","htmlHelpers","helpers","vm","taskId","template","task","select2AvailableStates","changeWF","newState","comment","renderUserInfo","value","element","result","getUserInfo","then","data","html","FullName","renderActionInfo","getActionInfo","Name","refreshTaskForm","showTaskHistory","dialog","ui","url","urlContent","width","height","id","title","find","setTaskState","error","text","form","getForm","loader","success","showDefaultError","setTask","ID","ProcessInstance","AvailableStates","map","row","VisibleName","duplicateTask","confirm","func","generateStatusTemplate","status","prefix","className","generateLabelClassByStatus","parseDate","dateStr","dateArray","split","date","Date","parseInt","init","bindings","load","parent","getParameter","paramsArray","paramName","i","length","bindNewParameterElement","params","parameterName","parameter","removeClass","Value","bindTaskParametersTable","DataTable","autoWidth","columns","order","paging","bindTaskParameters","bindCommandsPanel","commands","ctrl","WorkflowCommandsPanelController","on","parseUrlParams","document","location","href","getTask","persistanceParams","ProcessParameters","Purpose","push","AvailableCommands","bind","item","services","window","jQuery"],"mappings":"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","file":"viewTaskController.js","sourcesContent":["ï»¿; var app = app || {};\r\napp.components = app.components || {};\r\napp.components.tasks = app.components.tasks || {};\r\napp.components.tasks.controllers = app.components.tasks.controllers || {}\r\napp.components.tasks.controllers.ViewTaskController = app.components.tasks.controllers.ViewTaskController ||\r\n    function (global, $, app, utils, dataBinder, tasksService) {\r\n        'use strict';\r\n        var htmlHelpers = app.components.tasks.helpers.htmlHelpers;\r\n\r\n        var vm = this;\r\n        vm.taskId = null;\r\n        vm.template = '[ng-controller=ViewTaskController]';\r\n        vm.task = null;\r\n        vm.select2AvailableStates = null;\r\n        vm.changeWF = {\r\n            newState: null,\r\n            comment: ''\r\n        }\r\n\r\n        vm.renderUserInfo = function (value, element) {\r\n            var result = '';\r\n            if (value) {\r\n                result = '<span class=\"glyphicon glyphicon-refresh animated rotate\"></span>';\r\n                tasksService.getUserInfo(value).then(\r\n                    function (data) {\r\n                        if (data) {\r\n                            element.html(data.FullName + ' \\\\ ' + value);\r\n                        } else {\r\n                            element.html(value);\r\n                        }\r\n                    },\r\n                    function () {\r\n                        element.html(value);\r\n                    });\r\n            }\r\n            return result;\r\n        }\r\n\r\n        vm.renderActionInfo = function (value, element) {\r\n            var result = '';\r\n            if (value && element.data('action-type')) {\r\n                result = '<span class=\"glyphicon glyphicon-refresh animated rotate\"></span>';\r\n                tasksService.getActionInfo(element.data('action-type'), value).then(\r\n                    function (data) {\r\n                        if (data) {\r\n                            element.html(value + ' - ' + data.Name);\r\n                        } else {\r\n                            element.html(value);\r\n                        }\r\n                    },\r\n                    function () {\r\n                        element.html(value);\r\n                    });\r\n            }\r\n            return result;\r\n        }\r\n\r\n        vm.refreshTaskForm = function () {\r\n            refreshTaskForm(vm.taskId);\r\n        }\r\n\r\n        vm.showTaskHistory = function () {\r\n            var dialog = utils.ui.dialog({\r\n                url: utils.urlContent('/task/history?id=' + vm.taskId + '&isPartial=true'),\r\n                width: 1100,\r\n                height: 550,\r\n                id: 'viewTaskHistoryDialog',\r\n                title: 'ÐÑÑÐ¾ÑÐ¸Ñ Ð·Ð°Ð´Ð°ÑÐ¸'\r\n            });\r\n            dialog.find('.modal-body').data('task-id', vm.taskId);\r\n        };\r\n\r\n        vm.setTaskState = function () {\r\n            if (!vm.changeWF.newState) {\r\n                utils.ui.error({ text: 'ÐÑÐ±ÐµÑÐ¸ÑÐµ Ð½Ð¾Ð²ÑÐ¹ ÑÑÐ°ÑÑÑ!' });\r\n                return;\r\n            }\r\n            if (!vm.changeWF.comment) {\r\n                utils.ui.error({ text: 'ÐÐ²ÐµÐ´Ð¸ÑÐµ ÐºÐ¾Ð¼ÐµÐ½ÑÐ°ÑÐ¸Ð¹!' });\r\n                return;\r\n            }\r\n            var form = getForm();\r\n            utils.ui.loader(form);\r\n            tasksService.setTaskState(vm.taskId, vm.changeWF.newState, vm.changeWF.comment).then(\r\n                function () {\r\n                    utils.ui.loader(form, false);\r\n                    utils.ui.success({\r\n                        text: 'Ð¡ÑÐ°ÑÑÑ ÑÑÐ¿ÐµÑÐ½Ð¾ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½'\r\n                    });\r\n                    refreshTaskForm(vm.taskId);\r\n                },\r\n                function () {\r\n                    showDefaultError(form);\r\n                }\r\n            );\r\n        }\r\n        vm.setTask = function (data) {\r\n            vm.taskId = data.ID;\r\n            vm.task = data;\r\n            vm.task.ProcessInstance = vm.task.ProcessInstance || {};\r\n            if (data.AvailableStates) {\r\n                vm.select2AvailableStates = data.AvailableStates.map(function (row) {\r\n                    return { id: row.Name, text: row.VisibleName }\r\n                });\r\n\r\n            }\r\n        }\r\n\r\n        vm.duplicateTask = function () {\r\n            utils.ui.confirm({\r\n                text: 'ÐÑ ÑÐ²ÐµÑÐµÐ½Ñ ÑÑÐ¾ ÑÐ¾ÑÐ¸ÑÐµ Ð¿ÑÐ¾Ð´ÑÐ±Ð»Ð¸ÑÐ¾Ð²Ð°ÑÑ Ð·Ð°Ð´Ð°ÑÑ',\r\n                func: function () {\r\n                    var form = getForm();\r\n                    utils.ui.loader(form);\r\n                    tasksService.duplicateTask(vm.taskId).then(\r\n                        function () {\r\n                            utils.ui.loader(form, false);\r\n                            utils.ui.success({\r\n                                text: 'ÐÐ°Ð´Ð°ÑÐ° ÑÑÐ¿ÐµÑÐ½Ð¾ Ð¿ÑÐ¾Ð´ÑÐ±Ð»Ð¸ÑÐ¾Ð²Ð°Ð½Ð°'\r\n                            });\r\n                        },\r\n                        function () {\r\n                            showDefaultError(form);\r\n                        }\r\n                    );\r\n                }\r\n            });\r\n        }\r\n\r\n        vm.generateStatusTemplate = function(status) {\r\n            var prefix = '<span class=\"';\r\n            var className = htmlHelpers.generateLabelClassByStatus(status);\r\n            return prefix + className + '\">' + status + '</span>';\r\n        }\r\n\r\n        function showDefaultError(form) {\r\n            utils.ui.loader(form, false);\r\n            utils.ui.error({\r\n                text: 'Ð§ÑÐ¾-ÑÐ¾ Ð¿Ð¾ÑÐ»Ð¾ Ð½Ðµ ÑÐ°Ðº. Ð¡Ð»ÑÑÐ¸Ð»Ð°ÑÑ Ð¾ÑÐ¸Ð±ÐºÐ° Ð¿ÑÐ¸ Ð¾ÑÐ¿ÑÐ°Ð²ÐºÐµ Ð·Ð°Ð¿ÑÐ¾ÑÐ°'\r\n            });\r\n        }\r\n\r\n        function parseDate(dateStr) {\r\n            var dateArray = dateStr.split('/');\r\n            var date = new Date(dateArray[2], parseInt(dateArray[1]) - 1, dateArray[0]);\r\n            return date;\r\n        }\r\n\r\n        vm.init = init;\r\n\r\n        function refreshTaskForm(taskId) {\r\n            var form = getForm();\r\n            form.bindings('destroy');\r\n            utils.ui.loader(form);\r\n            form.load(utils.urlContent('/task/item/' + taskId + '?isPartial=true'), function () {\r\n                utils.ui.loader(form, false);\r\n            });\r\n        }\r\n        function getForm() {\r\n\r\n            var form = $(vm.template).parent();\r\n            return form;\r\n        }\r\n\r\n        function getParameter(paramsArray, paramName) {\r\n            if (paramsArray) {\r\n                for (var i = 0; i < paramsArray.length; i++) {\r\n                    if (paramsArray[i].Name === paramName) {\r\n                        return paramsArray[i];\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        }   \r\n\r\n        function bindNewParameterElement(params, parameterName) {\r\n            \r\n            var parameter = getParameter(params, parameterName);\r\n            if (parameter !== null && typeof parameter !== 'undefined') {\r\n                var form = getForm();\r\n                form.find('.new-' + parameterName).removeClass('hidden');\r\n                vm.task[parameterName] = parameter.Value;\r\n            }            \r\n        }\r\n\r\n        function bindTaskParametersTable(params) {\r\n            if (params && params.length > 0) {\r\n                $('#taskParametersTable').DataTable({\r\n                    data: params,\r\n                    width: '100%',\r\n                    autoWidth: true,\r\n                    columns: [{\r\n                        data: 'Name'\r\n                    }, {\r\n                        data: 'Value'\r\n                    }],\r\n                    order: [[0, 'asc']],\r\n                    paging: false\r\n                });\r\n            }\r\n        }\r\n\r\n        function bindTaskParameters(params) {\r\n            bindTaskParametersTable(params);\r\n\r\n            bindNewParameterElement(params, 'NewPlannedDate');\r\n            bindNewParameterElement(params, 'NewObserver');\r\n            bindNewParameterElement(params, 'NewResponsible');\r\n            bindNewParameterElement(params, 'NewStatus');\r\n        }\r\n\r\n        function bindCommandsPanel(commands) {\r\n            \r\n            var form = getForm();\r\n            var template = form.find('#workflowCommandsPanel');\r\n            var ctrl = new app.components.tasks.controllers.WorkflowCommandsPanelController(\r\n                template, commands, $, utils, tasksService\r\n            );\r\n            ctrl.on('submit', function () { refreshTaskForm(vm.taskId); });\r\n            ctrl.init();\r\n        }\r\n\r\n        function init(id) {\r\n            var form = getForm();\r\n            id = form.data('task-id') || utils.parseUrlParams(global.document.location.href).id;\r\n\r\n            utils.ui.loader(form);\r\n            tasksService.getTask(id).then(\r\n                function (data) {\r\n                    utils.ui.loader(form, false);\r\n                    vm.setTask(data);\r\n\r\n                    var persistanceParams = [];\r\n                    data.ProcessInstance = data.ProcessInstance || {};\r\n                    data.ProcessInstance.ProcessParameters = data.ProcessInstance.ProcessParameters || [];\r\n                    data.ProcessInstance.ProcessParameters.map(function (row) {\r\n                        if (row.Purpose === 'Persistence') { persistanceParams.push(row); }\r\n                    });\r\n                    bindTaskParameters(persistanceParams);\r\n\r\n                    bindCommandsPanel(data.AvailableCommands);\r\n                    dataBinder.bind(form, vm);\r\n                    form.bindings('create')(vm);\r\n                },\r\n                function () {\r\n                    showDefaultError(form);\r\n                }\r\n            );\r\n        }\r\n    };\r\n\r\napp.components.tasks.item = (function (global, $, app, utils, dataBinder) {\r\n    $(function () {\r\n        var ctrl = new app.components.tasks.controllers.ViewTaskController(\r\n            global, $, app, utils, dataBinder, app.components.tasks.services.tasksService);\r\n        ctrl.init();\r\n    });\r\n}(window, jQuery, app, app.utils, dataBinder));"]}